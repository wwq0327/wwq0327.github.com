<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: south | WanQing's Blog]]></title>
  <link href="http://wwq0327.github.com/blog/categories/south/atom.xml" rel="self"/>
  <link href="http://wwq0327.github.com/"/>
  <updated>2012-09-20T19:19:13+08:00</updated>
  <id>http://wwq0327.github.com/</id>
  <author>
    <name><![CDATA[wwq0327]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[South 使用记录]]></title>
    <link href="http://wwq0327.github.com/blog/2012/05/21/django-south-install/"/>
    <updated>2012-05-21T11:22:00+08:00</updated>
    <id>http://wwq0327.github.com/blog/2012/05/21/django-south-install</id>
    <content type="html"><![CDATA[<h3>创建虚拟环境</h3>

<p><code>bash
[wyatt@localhost git]$ virtualenv my_app
New python executable in my_app/bin/python
Installing setuptools............done.
Installing pip...............done.
</code></p>

<p><code>bash
$ cd my_app
$ source bin/active
</code></p>

<h3>安装django</h3>

<p><code>bash
$ pip install django==1.3
</code></p>

<h3>创建项目</h3>

<p><code>bash
$ django-admin.py startproject my_prj
</code>
<code>bash
$ chmod +x manage.py
</code></p>

<p><code>bash
$ cd my_prj
$ ./manage.py startapp app
</code></p>

<h3>安装South</h3>

<p><code>bash
$ pip install south
</code></p>

<h3>setttings.py 修改</h3>

<p>将south加入到 <code>INSTALLED_APP</code>中。</p>

<p>同步数据库</p>

<p><code>bash
./manage.py syncdb
</code></p>

<p>```python</p>

<p>DATABASES = {</p>

<pre><code>'default': {
    'ENGINE': 'django.db.backends.sqlite3', # Add 'postgresql_psycopg2', 'postgresql', 'mysql', 'sqlite3' or 'oracle'.
    'NAME': 'test.db',                      # Or path to database file if using sqlite3.
    'USER': '',                      # Not used with sqlite3.
    'PASSWORD': '',                  # Not used with sqlite3.
    'HOST': '',                      # Set to empty string for localhost. Not used with sqlite3.
    'PORT': '',                      # Set to empty string for default. Not used with sqlite3.
}
</code></pre>

<p>}
```</p>

<h3>创建app的数据模型</h3>

<p>```python</p>

<h1>filename: app/models.py</h1>

<p>from django.db import models</p>

<p>class Blog(models.Model):</p>

<pre><code>title = models.CharField(max_length=255)

def __unicode__(self):
    return self.title
</code></pre>

<p>```</p>

<p>将 <code>app</code> 安装到 <code>INSTALLED_APP</code>中。</p>

<p>```bash</p>

<p>(my_app)[wyatt@localhost my_prj]$ ./manage.py schemamigration app --initial
Creating migrations directory at '/home/wyatt/git/my_app/my_prj/app/migrations'...
Creating <strong>init</strong>.py in '/home/wyatt/git/my_app/my_prj/app/migrations'...
 + Added model app.Blog
Created 0001_initial.py. You can now apply this migration with: ./manage.py migrate app</p>

<p>```</p>

<p>创建应用的数据表</p>

<p>```bash
(my_app)[wyatt@localhost my_prj]$ ./manage.py migrate app
Running migrations for app:
 - Migrating forwards to 0001_initial.</p>

<blockquote><p>app:0001_initial
 - Loading initial data for app.
No fixtures found.
```</p></blockquote>

<p>修改models.py，添加一个content字段：</p>

<p>```python</p>

<pre><code>content = models.TextField()
</code></pre>

<p>```</p>

<p>再执行：
```bash</p>

<p>(my_app)[wyatt@localhost my_prj]$ ./manage.py schemamigration app --auto
 ? The field 'Blog.content' does not have a default specified, yet is NOT NULL.
 ? Since you are adding this field, you MUST specify a default
 ? value to use for existing rows. Would you like to:
 ?  1. Quit now, and add a default to the field in models.py
 ?  2. Specify a one-off value to use for existing columns now
 ? Please select a choice: 1</p>

<p>```</p>

<p>字段非空</p>

<p>将 <code>models.py</code> 修改下：
```python</p>

<pre><code>content = models.TextField(blank=True)
</code></pre>

<p>```</p>

<p><code>bash
(my_app)[wyatt@localhost my_prj]$ ./manage.py schemamigration app --auto
 + Added field content on app.Blog
Created 0002_auto__add_field_blog_content.py. You can now apply this migration with: ./manage.py migrate app
</code></p>

<p>将更改应用到数据表中</p>

<p>```bash
(my_app)[wyatt@localhost my_prj]$ ./manage.py migrate app
Running migrations for app:
 - Migrating forwards to 0002_auto__add_field_blog_content.</p>

<blockquote><p>app:0002_auto__add_field_blog_content
 - Loading initial data for app.
No fixtures found.
```</p></blockquote>

<p>参考：</p>

<p>http://pressedweb.com/tutorials/django-djourney-introduction-to-south/</p>
]]></content>
  </entry>
  
</feed>
